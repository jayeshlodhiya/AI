<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AI Call Assistants</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg:#f7f8fb; --panel:#fff; --text:#0f172a; --muted:#6b7280;
            --border:#e5e7eb; --radius:18px; --shadow:0 8px 24px rgba(16,24,40,.06);
            --chip-bg:#eaf6ee; --chip-text:#166534;
            --brand:#6c4df6; --brand-strong:#5b3df0;
            --line:#e7edf7; --success:#10b981; --danger:#ef4444; --warn:#f59e0b;
        }
        *{box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;padding:18px}

        .card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:18px}
        .card .header{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700;display:flex;align-items:center;justify-content:space-between}
        .card .body{padding:16px}

        .btn{border:0;border-radius:14px;padding:12px 18px;font-weight:700;display:inline-flex;gap:10px;align-items:center;cursor:pointer;box-shadow:var(--shadow);transition:background .15s ease, transform .06s ease}
        .btn:active{transform:translateY(1px)}
        .btn.gray{background:#f3f4f6;color:#1f2937;border:1px solid var(--border)}
        .btn.primary{background:var(--brand);color:#fff}
        .btn.primary:hover{background:var(--brand-strong)}
        .btn[disabled]{opacity:.6;cursor:not-allowed}

        .input,.select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff}

        .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:18px}

        /* ---------- Assistant Cards (screenshot style) ---------- */
        .assistants-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 20px; }
        .assistant-card { border: 1px solid #dbe2f0; border-radius: 16px; background: #fff; padding: 18px; display: flex; flex-direction: column; gap: 14px; box-shadow: 0 6px 18px rgba(2,6,23,.08); }
        .assistant-top { display: flex; align-items: center; justify-content: space-between; background: linear-gradient(90deg, rgba(108,77,246,.05), transparent); border-radius: 12px; padding: 8px 12px; gap: 12px; }
        .assistant-avatar { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; }
        .assistant-name { margin: 0; font-size: 18px; font-weight: 700; }
        .assistant-badge { display: inline-block; margin-top: 4px; padding: 4px 10px; border-radius: 8px; font-size: 12px; font-weight: 700; background: #eaf6ee; color: #166534; }
        .assistant-menu { width: 32px; height: 32px; border-radius: 8px; border: 1px solid #e5e7eb; background: #fff; display:flex; align-items:center; justify-content:center; cursor:pointer; }
        .assistant-title { font-size: 20px; font-weight: 700; color: #162449; margin: 0; }
        .assistant-company { display:flex; align-items:center; gap:8px; font-size:14px; font-weight:600; color:#8b2b2b; }
        .briefcase-ic { background:#fde8e8; color:#b91c1c; width:22px; height:22px; border-radius:6px; display:flex; align-items:center; justify-content:center; }
        .assistant-divider { height:1px; border:0; background:#e7edf7; }
        .assistant-actions { display:flex; gap:12px; margin-top:6px; }
        .btn.role { flex:1; background:#fff; border:1px solid #dbe2f0; color:#3a2e2e; }
        .btn.test { flex:1; background:#6c4df6; color:#fff; }

        .status{font-size:13px;color:var(--muted)}
        .spinner{width:12px;height:12px;border:2px solid #93c5fd;border-top-color:transparent;border-radius:50%;display:inline-block;animation:spin .8s linear infinite;margin-right:6px}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* ---------- Call History Table ---------- */
        .subnav{display:flex;gap:10px;flex-wrap:wrap}
        .chip{padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;font-weight:700;cursor:pointer}
        .chip.active{background:#eef2ff;border-color:#dbe2f0;color:#3730a3}

        .filters{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-top:12px}
        @media (max-width: 980px){ .filters{grid-template-columns:repeat(2,1fr)} }

        .table-wrap{margin-top:12px;border:1px solid var(--border);border-radius:14px;overflow:auto}
        table{width:100%;border-collapse:separate;border-spacing:0}
        thead th{position:sticky;top:0;background:#f8fafc;font-size:12px;color:#64748b;text-align:left;padding:10px;border-bottom:1px solid var(--border)}
        tbody td{padding:12px;border-bottom:1px solid #f1f5f9;font-size:14px}
        tbody tr:hover{background:#fbfdff}

        .status-pill{padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px;display:inline-block}
        .status-success{background:#e8fff6;color:#065f46}
        .status-failed{background:#fee2e2;color:#991b1b}
        .status-ongoing{background:#fff7ed;color:#9a3412}

        .pagination{display:flex;align-items:center;justify-content:space-between;margin-top:12px;gap:10px}
        .page-buttons{display:flex;gap:8px}
        .btn-lite{border:1px solid var(--border);background:#fff;border-radius:10px;padding:8px 10px;font-weight:700;cursor:pointer}
        .page-info{font-size:12px;color:#64748b}
        /* ---- Modal ---- */
        .modal.hidden { display:none; }
        .modal { position:fixed; inset:0; z-index:1000; }
        .modal__backdrop { position:absolute; inset:0; background:rgba(2,6,23,.45); backdrop-filter:saturate(120%) blur(2px); }
        .modal__dialog {
            position:relative; z-index:1; width:min(880px, 92vw); max-height:86vh; overflow:auto;
            margin:6vh auto 0; background:#fff; border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow);
        }
        .modal__header, .modal__footer { padding:12px 16px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
        .modal__footer { border-top:1px solid var(--border); border-bottom:0; }
        .modal__body { padding:14px 16px; }

        .modal__close { border:1px solid var(--border); background:#fff; border-radius:10px; padding:6px 10px; cursor:pointer; }
        .kv { display:grid; grid-template-columns: 200px 1fr; gap:10px 14px; }
        .kv .k { color:#64748b; font-weight:600; }
        .kv .v { white-space:pre-wrap; word-break:break-word; }
        .kv .sep { grid-column: 1 / -1; height:1px; background:#e7edf7; margin:4px 0; border-radius:999px; }
        .kv code.json { display:block; padding:10px; border:1px solid var(--border); border-radius:10px; background:#f8fafc; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; }

    </style>
</head>
<body>

<!-- Top controls -->
<section class="card">
    <div class="header">
        <span>🤖 AI Call Assistants</span>
        <div>
            <button class="btn gray" id="refreshBtn">Refresh</button>
            <button class="btn primary" id="openCreateBtn">➕ Create Assistant</button>
        </div>
    </div>
    <div class="body">
        <div id="statusText" class="status"><span class="spinner"></span> Loading assistants…</div>
    </div>
</section>

<!-- Existing Assistants -->
<section class="card">
    <div class="header">
        Existing Assistants
        <span id="countPill" class="assistant-badge" style="display:none"></span>
    </div>

    <div class="body">
        <div id="assistantsList" class="assistants-grid" aria-live="polite"></div>
        <div id="emptyState" class="status" style="display:none">No assistants found.</div>
    </div>

    <!-- Template for one assistant card -->
    <template id="assistantCardTemplate">
        <article class="assistant-card" data-assistant-id="">
            <header class="assistant-top">
                <img data-role="avatar" class="assistant-avatar" src="https://placehold.co/112x112" alt="Assistant avatar" />
                <div>
                    <h3 class="assistant-name" data-role="name">Assistant Name</h3>
                    <span class="assistant-badge" data-role="direction">OUTBOUND</span>
                </div>
                <button class="assistant-menu" title="More actions">⋯</button>
            </header>

            <h4 class="assistant-title" data-role="title">Customer Engagement and Relationship Management</h4>
            <div class="assistant-company">
                <span class="briefcase-ic" aria-hidden="true">💼</span>
                <span data-role="company">Awaaz ai</span>
            </div>

            <hr class="assistant-divider" />

            <div class="assistant-actions">
                <button class="btn primary" data-action="assistant-call">📞 Call</button>
            </div>

            <input type="hidden" data-role="hidden-name" />
            <input type="hidden" data-role="hidden-phone" />
        </article>
    </template>
</section>

<!-- Create Assistant -->
<section class="card" id="createCard" style="display:none;">
    <div class="header">
        <span>Create New Assistant</span>
        <div>
            <button class="btn gray" id="cancelCreateBtn">Cancel</button>
            <button class="btn primary" id="createBtn">Create</button>
        </div>
    </div>
    <div class="body" style="display:grid;gap:12px">
        <input id="ca_name" class="input" placeholder="Assistant Name" />
        <input id="ca_company" class="input" placeholder="Company / Brand" />
        <input id="ca_voice" class="input" placeholder="Voice (optional)" />
        <textarea id="ca_prompt" class="input" rows="4" placeholder="System Prompt / Persona"></textarea>
        <div id="createStatus" class="status"></div>
    </div>
</section>

<!-- ===================== Call History (Mock first) ===================== -->
<section class="card" id="callHistoryCard">
    <div class="header">
        <span>📞 Call History</span>
        <div class="subnav" id="callsSubnav">
            <button class="chip active" data-filter-chip="all">All</button>
            <button class="chip" data-filter-chip="OUTBOUND">Outbound</button>
            <button class="chip" data-filter-chip="INBOUND">Inbound</button>
            <button class="chip" data-filter-chip="FAILED">Failed</button>
            <button class="chip" data-filter-chip="COMPLETED">Completed</button>
        </div>
    </div>

    <div class="body">
        <!-- Filters -->
        <div class="filters">
            <select id="fltAssistant" class="select">
                <option value="">All assistants</option>
            </select>
            <select id="fltStatus" class="select">
                <option value="">Any status</option>
                <option value="COMPLETED">Completed</option>
                <option value="FAILED">Failed</option>
                <option value="ONGOING">Ongoing</option>
            </select>
            <input id="fltSearch" class="input" placeholder="Search name / number / call id" />
            <input id="fltFrom" type="date" class="input" />
            <input id="fltTo" type="date" class="input" />
            <select id="pageSize" class="select"><option>10</option><option selected>20</option><option>50</option></select>
        </div>

        <!-- Table -->
        <div class="table-wrap">
            <table>
                <thead>
                <tr>
                    <th style="min-width:140px">Time</th>
                    <th style="min-width:120px">Assistant</th>
                    <th style="min-width:160px">Customer</th>
                    <th style="min-width:140px">Number</th>
                    <th style="min-width:110px">Status</th>
                    <th style="min-width:100px">Duration</th>
                    <th style="min-width:160px">Call ID</th>
                    <th style="min-width:120px">Actions</th>
                </tr>
                </thead>
                <tbody id="callsTbody"></tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <div class="page-buttons">
                <button id="prevPage" class="btn-lite">⟨ Prev</button>
                <button id="nextPage" class="btn-lite">Next ⟩</button>
            </div>
            <div class="page-info" id="pageInfo">Page 1 of 1</div>
        </div>
    </div>

    <!-- Row template -->
    <template id="callRowTemplate">
        <tr>
            <td data-col="time">—</td>
            <td data-col="assistant">—</td>
            <td data-col="customer">—</td>
            <td data-col="number">—</td>
            <td data-col="status"><span class="status-pill status-ongoing">ONGOING</span></td>
            <td data-col="duration">—</td>
            <td data-col="callId">—</td>
            <td data-col="actions">
                <button class="btn-lite" data-action="view-call">View</button>
                <button class="btn-lite" data-action="download-call">Download</button>
            </td>
        </tr>
    </template>

    <!-- Mock data (replace later by API) -->
    <script id="mockCalls" type="application/json">
        {
            "calls": [
                {"time":"2025-08-27T12:41:00Z","assistantId":"asst_001","assistantName":"Manisha","direction":"OUTBOUND","customerName":"Rohan Sharma","number":"+917350348860","status":"COMPLETED","durationSec":183,"callId":"CALL-7A2D9E"},
                {"time":"2025-08-27T11:05:00Z","assistantId":"asst_002","assistantName":"Arun","direction":"OUTBOUND","customerName":"Priya N","number":"+919999888877","status":"FAILED","durationSec":12,"callId":"CALL-1B8F22"},
                {"time":"2025-08-26T16:15:00Z","assistantId":"asst_001","assistantName":"Manisha","direction":"INBOUND","customerName":"Ketan Patel","number":"+918888777766","status":"COMPLETED","durationSec":245,"callId":"CALL-5C1AA0"},
                {"time":"2025-08-26T10:02:00Z","assistantId":"asst_003","assistantName":"Neha","direction":"OUTBOUND","customerName":"Nisha","number":"+911234567890","status":"ONGOING","durationSec":47,"callId":"CALL-00Z9AA"}
            ]
        }
    </script>
</section>

<!-- Quick Test template kept (if you want to use elsewhere) -->
<template id="quickTestCardTemplate">
    <div class="agent-card" data-assistant-id="">
        <div class="agent-top">
            <img class="agent-avatar" data-role="avatar" src="https://placehold.co/112x112" alt="Assistant Avatar">
            <div>
                <div class="agent-name" data-role="name">Assistant</div>
                <div class="badge" data-role="direction">OUTBOUND</div>
            </div>
            <div class="agent-menu" title="More">⋯</div>
        </div>

        <div class="agent-title" data-role="title">Use-case / Description</div>
        <div class="agent-company">
            <span class="briefcase">💼</span>
            <span data-role="company">Company</span>
        </div>
        <div class="agent-id">ID: <span data-role="id">—</span></div>

        <div class="divider"></div>

        <div style="display:flex;gap:10px">
            <input class="input" data-role="name-input" placeholder="Customer name (optional)">
            <input class="input" data-role="phone-input" placeholder="+917350348860">
        </div>

        <div class="agent-actions" style="margin-top:10px">
            <button class="btn role" data-action="assistant-role" disabled>🌐 Role Play</button>
            <button class="btn primary" data-action="assistant-test">📞 Test</button>
        </div>
    </div>
</template>
<!-- Call detail modal -->
<div id="callDetailModal" class="modal hidden" aria-hidden="true">
    <div class="modal__backdrop"></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="callDetailTitle">
        <div class="modal__header">
            <h3 id="callDetailTitle">Call Details</h3>
            <button class="modal__close" id="callDetailClose" aria-label="Close">✕</button>
        </div>
        <div class="modal__body">
            <div id="callDetailContent" class="kv"></div>
        </div>
        <div class="modal__footer">
            <button class="btn gray" id="callDetailClose2">Close</button>
        </div>
    </div>
</div>

<script src="js/ai-call.js"></script>
</body>
</html>
